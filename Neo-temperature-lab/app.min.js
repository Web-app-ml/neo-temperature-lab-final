const canvas=document.getElementById("particles"),powerInput=document.getElementById("powerInput"),inputValue=document.getElementById("inputValue"),fromUnit=document.getElementById("fromUnit"),toUnit=document.getElementById("toUnit"),precision=document.getElementById("precision"),precisionNum=document.getElementById("precisionNum"),sigfigs=document.getElementById("sigfigs"),scientific=document.getElementById("scientific"),swapBtn=document.getElementById("swapBtn"),copyBtn=document.getElementById("copyBtn"),shareCardBtn=document.getElementById("shareCardBtn"),resetBtn=document.getElementById("resetBtn"),favBtn=document.getElementById("favBtn"),copyLinkBtn=document.getElementById("copyLinkBtn"),clearAllBtn=document.getElementById("clearAllBtn"),hint=document.getElementById("hint"),statusPill=document.getElementById("statusPill"),resultText=document.getElementById("resultText"),historyList=document.getElementById("historyList"),clearHistoryBtn=document.getElementById("clearHistoryBtn"),exportCSV=document.getElementById("exportCSV"),matrixBody=document.getElementById("matrixBody"),premiumSwitch=document.getElementById("premiumSwitch"),premiumThemeWrap=document.getElementById("premiumThemeWrap"),premiumTheme=document.getElementById("premiumTheme"),proTools=document.getElementById("proTools"),autoCopy=document.getElementById("autoCopy"),soundFx=document.getElementById("soundFx"),favoritesBar=document.getElementById("favoritesBar"),favChips=document.getElementById("favChips"),clearFavs=document.getElementById("clearFavs"),analytics=document.getElementById("analytics"),statTotal=document.getElementById("statTotal"),statTopPair=document.getElementById("statTopPair"),statAvgP=document.getElementById("statAvgP"),fromCustom=document.getElementById("fromCustom"),toCustom=document.getElementById("toCustom"),Units={C:{sym:"°C",name:"Celsius",min:-273.15,toC:e=>e,fromC:e=>e},F:{sym:"°F",name:"Fahrenheit",min:-459.67,toC:e=>5*(e-32)/9,fromC:e=>9*e/5+32},K:{sym:"K",name:"Kelvin",min:0,toC:e=>e-273.15,fromC:e=>e+273.15},R:{sym:"°R",name:"Rankine",min:0,toC:e=>5*(e-491.67)/9,fromC:e=>9*(e+273.15)/5},Re:{sym:"°Re",name:"Réaumur",min:-218.52,toC:e=>5*e/4,fromC:e=>4*e/5}},UnitKeys=Object.keys(Units),clamp=(e,t,n)=>Math.min(n,Math.max(t,e));function debounce(e,t=120){let n;return(...o)=>{clearTimeout(n),n=setTimeout(()=>e(...o),t)}}const fmtTime=()=>(new Date).toLocaleTimeString(),prefersReduced=window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches;function makeURLState(){const e=new URLSearchParams({v:inputValue.value||"",from:fromUnit.value,to:toUnit.value,p:precision.value,sf:sigfigs.checked?"1":"0",sci:scientific.checked?"1":"0",q:powerInput.value||"",premium:document.body.classList.contains("premium")?"1":"0",theme:document.body.dataset.premiumTheme||"gold"});history.replaceState(null,"",`?${e.toString()}`)}function readURLState(){const e=new URLSearchParams(location.search);if(e.has("from")&&(fromUnit.value=e.get("from")),e.has("to")&&(toUnit.value=e.get("to")),e.has("p")){const t=clamp(+e.get("p")||2,0,8);precision.value=t,precisionNum.value=t}e.has("sf")&&(sigfigs.checked="1"===e.get("sf")),e.has("sci")&&(scientific.checked="1"===e.get("sci")),e.has("v")&&(inputValue.value=e.get("v")),e.has("q")&&(powerInput.value=e.get("q")),"1"===e.get("premium")&&enablePremium(!0);const t=e.get("theme");t&&setPremiumTheme(t,!0)}function toSigFigs(e,t){if(!isFinite(e))return"—";if(0===e)return"0";const n=Math.max(1,0|t);return Number(e).toPrecision(n)}function toFixedSmart(e,t,n){if(!isFinite(e))return"—";const o=Number(e),a=Math.abs(o);return n&&(0!==a&&a<.001||a>=1e6)?o.toExponential(t):o.toFixed(t)}function formatOut(e){const t=+precision.value;return sigfigs.checked?toSigFigs(e,t||2):toFixedSmart(e,t,scientific.checked)}function symbol(e){return Units[e]?.sym||e}function unitName(e){return Units[e]?.name||e}function validateAbsoluteZero(e,t){const n=Units[t]?.min;return void 0===n?{ok:!0}:e<n?{ok:!1,msg:`${unitName(t)} cannot be below absolute zero (${n} ${symbol(t)}).`}:{ok:!0}}function convert(e,t,n){const o=Units[t].toC(e);return Units[n].fromC(o)}function convertAll(e,t){const n={},o=Units[t].toC(e);for(const e of UnitKeys)n[e]=Units[e].fromC(o);return n}function parsePower(e){if(!e)return null;const t=e.trim().replace(/\s+/g," "),n="(?:c|°c|celsius|f|°f|fahrenheit|k|kelvin|r|°r|rankine|re|°re|reaumur)",o=new RegExp(`^(-?\\d+(?:\\.\\d+)?)\\s*(${n})?(?:\\s*(?:to|->|→)\\s*((${n})|all))?$`,"i"),a=t.match(o);if(!a)return null;const r=parseFloat(a[1]),i=a[3];return{v:r,from:normalizeUnit(a[2])||fromUnit.value,to:i&&"all"===i.toLowerCase()?"ALL":normalizeUnit(i)||toUnit.value}}function normalizeUnit(e){if(!e)return null;switch(e.replace("°","").toLowerCase()){case"c":case"celsius":return"C";case"f":case"fahrenheit":return"F";case"k":case"kelvin":return"K";case"r":case"rankine":return"R";case"re":case"reaumur":return"Re";default:return null}}function addHistory(e){const t=document.createElement("li");for(t.innerHTML=`\n    <span>${e.val} ${symbol(e.from)} → <strong>${e.outFormatted} ${symbol(e.to)}</strong></span>\n    <span class="pill">${fmtTime()}</span>\n  `,historyList.prepend(t);historyList.children.length>12;)historyList.removeChild(historyList.lastChild)}function clearHistory(){historyList.innerHTML=""}function exportHistoryCSV(){const e=[["Time","FromValue","FromUnit","ToValue","ToUnit"]];Array.from(historyList.children).reverse().forEach(t=>{const n=t.querySelector(".pill")?.textContent||"",o=(t.querySelector("span")?.textContent||"").match(/^(.+?)\s([^\s]+)\s→\s(.+?)\s([^\s]+)$/);o&&e.push([n,o[1],o[2],o[3],o[4]])});const t=e.map(e=>e.map(e=>`"${String(e).replace(/"/g,'""')}"`).join(",")).join("\n"),n=new Blob([t],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(n),a=document.createElement("a");a.href=o,a.download="neo-temp-history.csv",document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(o)}const FAV_KEY="neoTempFavs";function getFavs(){try{return JSON.parse(localStorage.getItem(FAV_KEY)||"[]")}catch{return[]}}function setFavs(e){localStorage.setItem(FAV_KEY,JSON.stringify(e.slice(0,12)))}function pairKey(e,t){return`${e}->${t}`}function renderFavs(){favChips.innerHTML="";const e=getFavs();e.length?e.forEach(e=>{const[t,n]=e.split("->"),o=document.createElement("button");o.className="chip",o.textContent=`${symbol(t)} → ${symbol(n)}`,o.title=`Use ${t} to ${n}`,o.addEventListener("click",()=>{fromUnit.value=t,toUnit.value=n,syncGoldSelects(),runConvert(!0)}),favChips.appendChild(o)}):favChips.innerHTML='<div class="muted">No favorites yet. Click ☆ Favorite to save this pair.</div>'}function addCurrentToFavs(){if(!isPremium())return void pulsePill("warn","Premium feature");const e=pairKey(fromUnit.value,toUnit.value),t=getFavs();t.includes(e)||t.unshift(e),setFavs(t),renderFavs(),pulsePill("ok","Saved to favorites")}function clearFavorites(){localStorage.removeItem(FAV_KEY),renderFavs(),pulsePill("ok","Favorites cleared")}const STATS_KEY="neoTempStats";function getStats(){try{return JSON.parse(localStorage.getItem(STATS_KEY)||'{"total":0,"pairs":{},"pSum":0,"pCount":0}')}catch{return{total:0,pairs:{},pSum:0,pCount:0}}}function setStats(e){localStorage.setItem(STATS_KEY,JSON.stringify(e))}function bumpStats(e,t){const n=getStats();n.total+=1;const o=pairKey(e,t);n.pairs[o]=(n.pairs[o]||0)+1,n.pSum+=+precision.value||0,n.pCount+=1,setStats(n),renderStats()}function renderStats(){if(!isPremium())return;const e=getStats();statTotal.textContent=e.total;const t=Object.entries(e.pairs).sort((e,t)=>t[1]-e[1])[0];statTopPair.textContent=t?`${t[0]} (${t[1]})`:"—",statAvgP.textContent=e.pCount?(e.pSum/e.pCount).toFixed(2):"—"}function setStatus(e,t){statusPill.className="pill"+(e?` ${e}`:""),statusPill.textContent=t}function setHint(e){hint.textContent=e||""}function pulseResult(){resultText.style.transform="translateY(-1px) scale(1.01)",requestAnimationFrame(()=>{resultText.style.transform=""})}function pulsePill(e,t){setStatus(e,t),setTimeout(()=>setStatus(null,"Ready"),1200)}function celsiusNormalized(e){const t=(e- -50)/200;return clamp(Math.round(100*t),0,100)}function renderMatrix(e,t){const n=convertAll(e,t);matrixBody.innerHTML="";const o=celsiusNormalized(Units[t].toC(e));for(const e of UnitKeys){const t=document.createElement("tr"),a=n[e];t.innerHTML=`\n      <td><strong>${unitName(e)}</strong> <span class="muted">(${symbol(e)})</span></td>\n      <td>${formatOut(a)}<div class="meter" style="--pct:${isPremium()?o:0}%"></div></td>\n      <td>${Units[e].min} ${symbol(e)}</td>\n    `,matrixBody.appendChild(t)}}function runConvert(e=!0){const t=inputValue.value.trim();if(!t)return resultText.textContent="—",matrixBody.innerHTML="",setHint(""),setStatus(null,"Ready"),inputValue.classList.remove("input-error"),void makeURLState();const n=Number(t);if(Number.isNaN(n))return setStatus("warn","Invalid number"),setHint("Please enter a valid numeric value."),resultText.textContent="—",matrixBody.innerHTML="",void inputValue.classList.add("input-error");const o=fromUnit.value,a=toUnit.value,r=validateAbsoluteZero(n,o);if(!r.ok)return inputValue.classList.add("input-error"),setStatus("err","Below absolute zero"),setHint(r.msg),resultText.textContent="—",void(matrixBody.innerHTML="");inputValue.classList.remove("input-error"),setStatus("ok","OK"),setHint("");const i=convert(n,o,a);if(renderResult({val:n,from:o,to:a,out:i}),renderMatrix(n,o),e&&addHistory({val:n,from:o,to:a,outFormatted:formatOut(i)}),makeURLState(),pulseResult(),isPremium()&&bumpStats(o,a),isPremium()&&autoCopy.checked){const e=resultText.textContent.trim();navigator.clipboard?.writeText(e).then(()=>{setHint("Auto-copied!"),setTimeout(()=>{"Auto-copied!"===hint.textContent&&setHint("")},1e3),playChime(),vibrate(10)}).catch(()=>{})}}const runConvertDebounced=debounce(()=>runConvert(!0),120);function renderResult({val:e,from:t,to:n,out:o}){resultText.textContent=`${formatOut(e)} ${symbol(t)} = ${formatOut(o)} ${symbol(n)}`}function applyPowerInput(){const e=parsePower(powerInput.value);if(!e)return setStatus("warn","Could not parse input"),void setHint('Try: "37 C to F", "98.6F", or "100 C -> all"');inputValue.value=String(e.v),fromUnit.value=e.from,toUnit.value="ALL"===e.to?toUnit.value:e.to,syncGoldSelects(),setStatus("ok","Parsed"),setHint(""),"ALL"===e.to?(runConvert(!1),setHint("Converted to all units in the matrix below.")):runConvert(!0),makeURLState()}async function copyResult(){const e=resultText.textContent.trim();if(e&&"—"!==e)try{await navigator.clipboard.writeText(e),setHint("Copied result!"),setTimeout(()=>{"Copied result!"===hint.textContent&&setHint("")},1200),playChime(),vibrate(10)}catch{setHint("Copy not allowed by browser.")}}function resetInputs(){inputValue.value="",powerInput.value="",runConvert(!1)}function resetAll(){resetInputs(),fromUnit.value="C",toUnit.value="F",syncGoldSelects(),precision.value=2,precisionNum.value=2,sigfigs.checked=!1,scientific.checked=!1,clearHistory(),makeURLState(),setStatus(null,"Ready"),setHint("")}function swapUnits(){const e=fromUnit.value;fromUnit.value=toUnit.value,toUnit.value=e,syncGoldSelects(),runConvert(!0),playChime(880),vibrate(8)}async function copyLink(){makeURLState();try{await navigator.clipboard.writeText(location.href),setHint("Link copied!"),setTimeout(()=>{"Link copied!"===hint.textContent&&setHint("")},1200),playChime(1320),vibrate(6)}catch{setHint("Copy blocked by browser.")}}const PREMIUM_KEY="neoTempPremium",THEME_KEY="neoTempPremiumTheme";function isPremium(){return document.body.classList.contains("premium")}function enablePremium(e=!1){document.body.classList.add("premium"),premiumSwitch.checked=!0,proTools.hidden=!1,favoritesBar.hidden=!1,analytics.hidden=!1,premiumThemeWrap.hidden=!1,fromCustom.hidden=!1,toCustom.hidden=!1,Array.from(document.querySelectorAll(".native-select")).forEach(e=>e.style.display="none"),localStorage.setItem(PREMIUM_KEY,"1"),e||pulsePill("ok","Premium enabled"),renderFavs(),renderStats(),initGoldSelects(),syncGoldSelects(),runConvert(!1)}function disablePremium(e=!1){document.body.classList.remove("premium","theme-rose","theme-plat"),document.body.dataset.premiumTheme="gold",premiumSwitch.checked=!1,proTools.hidden=!0,favoritesBar.hidden=!0,analytics.hidden=!0,premiumThemeWrap.hidden=!0,fromCustom.hidden=!0,toCustom.hidden=!0,Array.from(document.querySelectorAll(".native-select")).forEach(e=>e.style.display=""),localStorage.setItem(PREMIUM_KEY,"0"),localStorage.setItem(THEME_KEY,"gold"),e||pulsePill(null,"Premium off"),runConvert(!1)}function setPremiumTheme(e="gold",t=!1){document.body.dataset.premiumTheme=e,document.body.classList.remove("theme-rose","theme-plat"),"rose"===e?document.body.classList.add("theme-rose"):"platinum"===e&&document.body.classList.add("theme-plat"),t||pulsePill("ok","gold"===e?"Classic Gold":"rose"===e?"Rose Gold":"Platinum"),localStorage.setItem(THEME_KEY,e)}function restorePremiumFromStorage(){"1"===localStorage.getItem(PREMIUM_KEY)&&enablePremium(!0);const e=localStorage.getItem(THEME_KEY)||"gold";premiumTheme.value="platinum"===e?"platinum":e,setPremiumTheme(e,!0)}const UnitItems=UnitKeys.map(e=>({key:e,icon:Units[e].sym,label:Units[e].name}));function initGoldSelects(){[fromCustom,toCustom].forEach((e,t)=>{const n=e.querySelector(".gold-select__list");n.innerHTML="",UnitItems.forEach(t=>{const o=document.createElement("li");o.setAttribute("role","option"),o.dataset.key=t.key,o.innerHTML=`<span class="gold-select__icon">${t.icon}</span><span>${t.label}</span>`,o.addEventListener("click",()=>{e.querySelector(".gold-select__btn").dataset.for,"from"===e.querySelector(".gold-select__btn").dataset.for?fromUnit.value=t.key:toUnit.value=t.key,syncGoldSelects(),closeGoldSelect(e),runConvert(!0)}),n.appendChild(o)});const o=e.querySelector(".gold-select__btn");o.dataset.for="fromCustom"===e.id?"from":"to",o.addEventListener("click",()=>{const t=e.querySelector(".gold-select__panel"),n=!t.classList.contains("open");closeAllGoldSelects(),n&&(t.classList.add("open"),t.querySelector(".gold-select__search").focus())}),e.querySelector(".gold-select__search").addEventListener("input",e=>{const t=e.target.value.toLowerCase();Array.from(n.children).forEach(e=>{e.style.display=e.textContent.toLowerCase().includes(t)?"":"none"})})}),document.addEventListener("click",e=>{e.target.closest(".gold-select")||closeAllGoldSelects()})}function closeGoldSelect(e){e.querySelector(".gold-select__panel").classList.remove("open")}function closeAllGoldSelects(){document.querySelectorAll(".gold-select__panel.open").forEach(e=>e.classList.remove("open"))}function syncGoldSelects(){if(!isPremium())return;const e={from:fromCustom,to:toCustom};Object.entries(e).forEach(([e,t])=>{const n="from"===e?fromUnit.value:toUnit.value;t.querySelector(".gold-select__icon").textContent=Units[n].sym,t.querySelector(".gold-select__label").textContent=Units[n].name,t.querySelectorAll(".gold-select__list li").forEach(e=>e.setAttribute("aria-selected",e.dataset.key===n?"true":"false"))})}const ctx=canvas.getContext("2d");let actx,particles=[],lastT=0,lowFPS=!1;function resizeCanvas(){canvas.width=innerWidth,canvas.height=innerHeight}function spawn(e,t,n="gold"){if(!prefersReduced&&!lowFPS)for(let o=0;o<6;o++)particles.push({x:e,y:t,vx:1.2*(Math.random()-.5),vy:1.2*(Math.random()-.5)-.4,a:1,r:1+2*Math.random(),c:"gold"===n?"rgba(246,214,107,":"rgba(138,180,248,",life:700})}function tick(e){const t=lastT?e-lastT:16;lastT=e,t>80&&(lowFPS=!0),ctx.clearRect(0,0,canvas.width,canvas.height),performance.now(),particles=particles.filter(e=>(e.life-=t)>0);for(const e of particles)e.x+=e.vx*t/16,e.y+=e.vy*t/16,e.a=Math.max(0,e.life/700),ctx.beginPath(),ctx.arc(e.x,e.y,e.r,0,2*Math.PI),ctx.fillStyle=`${e.c}${e.a})`,ctx.fill();requestAnimationFrame(tick)}function initTilt(){document.querySelectorAll("[data-tilt]").forEach(e=>{const t=+e.dataset.tiltMax||6;e.addEventListener("pointermove",function(n){if(prefersReduced)return;const o=e.getBoundingClientRect(),a=o.left+o.width/2,r=o.top+o.height/2,i=(n.clientX-a)/o.width,s=(n.clientY-r)/o.height;e.style.transform=`rotateX(${-s*t}deg) rotateY(${i*t}deg)`}),e.addEventListener("pointerleave",function(){e.style.transform=""})})}function playChime(e=1040){if(isPremium()&&soundFx.checked)try{actx=actx||new(window.AudioContext||window.webkitAudioContext);const t=actx.createOscillator(),n=actx.createGain();t.type="sine",t.frequency.value=e,t.connect(n),n.connect(actx.destination),n.gain.setValueAtTime(1e-4,actx.currentTime),n.gain.exponentialRampToValueAtTime(.15,actx.currentTime+.02),n.gain.exponentialRampToValueAtTime(1e-4,actx.currentTime+.15),t.start(),t.stop(actx.currentTime+.16)}catch{}}function vibrate(e=10){isPremium()&&soundFx.checked&&navigator.vibrate&&navigator.vibrate(e)}window.addEventListener("resize",resizeCanvas),resizeCanvas(),requestAnimationFrame(tick),window.addEventListener("pointermove",e=>isPremium()?spawn(e.clientX,e.clientY,"gold"):null),initTilt();const CARD_LOGO_SRC="./web-app-manifest-192x192.png",CARD_LOGO=new Image;function currentThemeKey(){if(!isPremium())return"normal";const e=document.body;return e.classList.contains("theme-rose")?"rose":e.classList.contains("theme-plat")?"plat":"gold"}function themeColors(e){switch(e){case"rose":return{bg1:"#5d2e36",bg2:"#33161a",bezelA:"#5b2e36",bezelB:"#f7b2b2",text:"#fff2f4",sub:"#ffd1d6",accent:"#f6d66b"};case"plat":return{bg1:"#3c4752",bg2:"#1f262d",bezelA:"#6f7f8f",bezelB:"#d8e1e8",text:"#eef3f7",sub:"#dfe7ee",accent:"#d8e1e8"};case"gold":return{bg1:"#2b2414",bg2:"#0f0b05",bezelA:"#5d4e2a",bezelB:"#f6e27a",text:"#fff6cf",sub:"#e5d9ad",accent:"#f6d66b"};default:return{bg1:"#0f1629",bg2:"#0a0f1c",bezelA:"#3a5a7a",bezelB:"#9cd3ff",text:"#eaf0ff",sub:"#a8b7d8",accent:"#6ad1ff"}}}function fillBrushed(e,t,n,o,a){const r=e.createLinearGradient(0,0,t,n);r.addColorStop(0,o),r.addColorStop(1,a),e.fillStyle=r,e.fillRect(0,0,t,n),e.globalAlpha=.06,e.fillStyle="rgba(255,255,255,0.18)";for(let o=0;o<n;o+=2)e.fillRect(0,o,t,1);e.globalAlpha=1}function overlayNoise(e,t,n,o=.04){const a=120,r=document.createElement("canvas");r.width=a,r.height=a;const i=r.getContext("2d"),s=i.createImageData(a,a);for(let e=0;e<s.data.length;e+=4){const t=220+35*Math.random()|0;s.data[e]=t,s.data[e+1]=t,s.data[e+2]=t,s.data[e+3]=35}i.putImageData(s,0,0);const l=e.createPattern(r,"repeat");e.save(),e.globalAlpha=o,e.fillStyle=l,e.fillRect(0,0,t,n),e.restore()}function strokeBezel(e,t,n,o){const{bezelA:a,bezelB:r}=themeColors(o),i=e.createLinearGradient(0,0,t,n);i.addColorStop(0,a),i.addColorStop(.5,r),i.addColorStop(1,a),e.save(),e.lineWidth=8,e.strokeStyle=i,e.strokeRect(14,14,t-28,n-28),e.strokeStyle="normal"===o?"rgba(255,255,255,0.12)":"rgba(246,214,107,0.22)",e.lineWidth=2,e.strokeRect(24,24,t-48,n-48),e.restore()}function drawRoundLogo(e,t,{cx0:n=68,cy0:o=58,r:a=30,fallback:r="🌡️"}={}){e.save(),e.beginPath(),e.arc(n,o,a,0,2*Math.PI),e.clip(),t&&t.complete&&t.naturalWidth?e.drawImage(t,n-a,o-a,2*a,2*a):(e.fillStyle="rgba(255,255,255,0.06)",e.fillRect(n-a,o-a,2*a,2*a),e.fillStyle="#ffffff",e.font="700 26px ui-sans-serif, system-ui",e.textAlign="center",e.textBaseline="middle",e.fillText(r,n,o)),e.restore(),e.save(),e.lineWidth=2.5,e.strokeStyle="rgba(255,255,255,0.35)",e.beginPath(),e.arc(n,o,a+1.25,0,2*Math.PI),e.stroke(),e.lineWidth=1.25,e.strokeStyle="rgba(0,0,0,0.35)",e.beginPath(),e.arc(n,o,a-1.25,0,2*Math.PI),e.stroke(),e.restore()}function drawNameplate(e,t,n,o,a,{padX:r=18,padY:i=10,radius:s=16,maxW:l=560,font:c="700 28px ui-sans-serif, system-ui, Segoe UI"}={}){e.font=c,e.textAlign="left",e.textBaseline="middle";let d=28,u=e.measureText(t).width;for(;u>l-2*r&&d>18;)d-=2,e.font=`700 ${d}px ui-sans-serif, system-ui, Segoe UI`,u=e.measureText(t).width;const m=Math.min(l,u+2*r),f=d+2*i;let p;"gold"===a?(p=e.createLinearGradient(n,o-f/2,n+m,o+f/2),p.addColorStop(0,"#5d4e2a"),p.addColorStop(.5,"#f6e27a"),p.addColorStop(1,"#5d4e2a")):"rose"===a?(p=e.createLinearGradient(n,o-f/2,n+m,o+f/2),p.addColorStop(0,"#6d3943"),p.addColorStop(.5,"#ffb7b2"),p.addColorStop(1,"#6d3943")):"plat"===a?(p=e.createLinearGradient(n,o-f/2,n+m,o+f/2),p.addColorStop(0,"#6f7f8f"),p.addColorStop(.5,"#d8e1e8"),p.addColorStop(1,"#6f7f8f")):(p=e.createLinearGradient(n,o-f/2,n+m,o+f/2),p.addColorStop(0,"#2a3b55"),p.addColorStop(.5,"#9cd3ff"),p.addColorStop(1,"#2a3b55")),e.save(),e.shadowColor="rgba(0,0,0,0.35)",e.shadowBlur=8,e.shadowOffsetY=2,e.beginPath();const h=s,y=n+m,g=o-f/2,v=o+f/2;return e.moveTo(n+h,g),e.lineTo(y-h,g),e.quadraticCurveTo(y,g,y,g+h),e.lineTo(y,v-h),e.quadraticCurveTo(y,v,y-h,v),e.lineTo(n+h,v),e.quadraticCurveTo(n,v,n,v-h),e.lineTo(n,g+h),e.quadraticCurveTo(n,g,n+h,g),e.closePath(),e.fillStyle=p,e.fill(),e.shadowBlur=0,e.strokeStyle="normal"===a?"rgba(255,255,255,0.35)":"rgba(255,245,205,0.45)",e.lineWidth=1.4,e.stroke(),e.fillStyle="normal"===a?"#0b1426":"#1b150a",e.fillText(t,n+r,o+1),e.fillStyle="normal"===a?"#eaf3ff":"#fffaf0",e.fillText(t,n+r,o-1),e.restore(),{w:m,h:f}}function drawHero(e,t,n,o,{maxWidth:a,maxSize:r=44,minSize:i=28,fill:s="#fff"}={}){let l=r;for(e.textAlign="left",e.textBaseline="alphabetic";l>=i&&(e.font=`700 ${l}px ui-sans-serif, system-ui, Segoe UI`,!(e.measureText(t).width<=a));)l-=2;e.save(),e.fillStyle=s,e.shadowColor="rgba(0,0,0,0.35)",e.shadowBlur=6,e.shadowOffsetY=2,e.fillText(t,n,o),e.shadowBlur=0,e.lineWidth=2,e.strokeStyle="rgba(255,255,255,0.12)",e.strokeText(t,n,o),e.restore()}function drawDottedLine(e,t,n,o,a="rgba(255,255,255,0.18)"){e.save(),e.strokeStyle=a,e.lineWidth=1,e.setLineDash([2,3]),e.beginPath(),e.moveTo(t,n),e.lineTo(o,n),e.stroke(),e.restore()}CARD_LOGO.src=CARD_LOGO_SRC;const UnitIcon={C:"°C",F:"°F",K:"🧪",R:"°R",Re:"°Re"};function drawMatrixTwoCol(e,t,n,o,a,r,i){const s=themeColors(n).sub,l="normal"===n?"#cfe2ff":"#fff6cf",c=o,d=o+r+40;let u=a,m=a;e.font="600 20px ui-sans-serif, system-ui, Segoe UI";const f=[...UnitKeys],p=Math.ceil(f.length/2),h=f.slice(0,p),y=f.slice(p);function g(n,o,a){const i=Units[n],c=UnitIcon[n]||"",d=`${i.name} ${c?`(${c})`:""}`,u=formatOut(t[n]);e.fillStyle=s,e.textAlign="left",e.fillText(d,o,a);const m=e.measureText(d).width,f=o+r;drawDottedLine(e,o+m+10,a-6,f-4,"rgba(255,255,255,0.15)"),e.fillStyle=l,e.textAlign="right",e.fillText(u,f,a),e.textAlign="left"}for(const e of h)g(e,c,u),u+=i;for(const e of y)g(e,d,m),m+=i}function stampIST(){try{return(new Date).toLocaleString("en-IN",{timeZone:"Asia/Kolkata"})}catch{return(new Date).toLocaleString()}}async function drawQR(e,t,n,o,a,r="rgba(246,214,107,0.45)"){if(!window.QRCode)return;const i=new window.QRCode(-1,window.QRCode.ErrorCorrectLevel.M);i.addData(t),i.make();const s=a/i.getModuleCount();e.save(),e.fillStyle="#000";for(let t=0;t<i.getModuleCount();t++)for(let a=0;a<i.getModuleCount();a++)i.isDark(t,a)&&e.fillRect(n+a*s,o+t*s,s,s);e.restore(),e.save(),e.strokeStyle=r,e.lineWidth=2,e.strokeRect(n-2,o-2,a+4,a+4),e.restore()}async function shareOrDownload(e,t="png",n=.92,o="neo-temp-share"){const a="jpeg"===t?"image/jpeg":"webp"===t?"image/webp":"image/png",r=await new Promise(t=>e.toBlob(t,a,n));if(!r){const r=document.createElement("a");return r.href=e.toDataURL(a,n),r.download=`${o}.${t}`,void r.click()}const i=new File([r],`${o}.${t}`,{type:a});if(navigator.canShare&&navigator.canShare({files:[i]}))await navigator.share({files:[i],title:"Neo Temperature Lab"});else{const e=URL.createObjectURL(r),n=document.createElement("a");n.href=e,n.download=`${o}.${t}`,n.click(),URL.revokeObjectURL(e)}}async function generateShareCard(e={}){const t=document.getElementById("shareFormat"),n=document.getElementById("shareQuality"),o=document.getElementById("sharePreset"),a=document.getElementById("shareQR")?.checked,r=o?.value||e.preset||"classic",i=t?.value||e.format||"png",s=Number(n?.value||e.quality||.92),l={classic:{w:900,h:470},social:{w:1200,h:630},story:{w:1080,h:1920},square:{w:1080,h:1080}},{w:c,h:d}=l[r]||l.classic,u=Math.min(window.devicePixelRatio||1,2),m=document.createElement("canvas");m.width=Math.round(c*u),m.height=Math.round(d*u),m.style.width=c+"px",m.style.height=d+"px";const f=m.getContext("2d");f.scale(u,u);const p=currentThemeKey(),h=themeColors(p);fillBrushed(f,c,d,h.bg1,h.bg2),isPremium()&&overlayNoise(f,c,d,.05),strokeBezel(f,c,d,p),drawRoundLogo(f,CARD_LOGO,{cx0:68,cy0:58,r:30,fallback:"🌡️"});const y=drawNameplate(f,"Neo Temperature Lab",112,58,p,{padX:18,padY:10,radius:16,maxW:c-112-36});f.font="600 16px ui-sans-serif, system-ui, Segoe UI",f.textAlign="left",f.textBaseline="alphabetic",f.fillStyle="normal"===p?"#cfe2ff":h.sub;const g=Number(inputValue.value||0),v=fromUnit.value,S=document.getElementById("toUnit")?.value||"F",C=document.getElementById("sigfigs")?.checked,w=document.getElementById("scientific")?.checked;f.fillText(`${formatOut(g)} ${Units[v].sym} → ${Units[S].sym} • ${C?"sig figs":"dp"} • sci ${w?"on":"off"}`,112,58+y.h/2+18),drawHero(f,resultText.textContent||"—",40,180,{maxWidth:c-80,maxSize:"story"===r?72:46,minSize:26,fill:h.text});const b=convertAll(g,v);if(f.font="600 20px ui-sans-serif, system-ui, Segoe UI",drawMatrixTwoCol(f,b,p,40,230,Math.floor((c-120)/2),34),f.font="14px ui-sans-serif, system-ui, Segoe UI",f.fillStyle="normal"===p?"#8b5cf6":h.accent,f.textAlign="left",f.fillText(`Generated ${stampIST()}`,40,d-28),f.save(),f.font="600 16px ui-sans-serif, system-ui, Segoe UI",f.textAlign="right",f.fillStyle="normal"===p?"#6ad1ff":h.accent,isPremium()&&(f.shadowColor="rgba(246,214,107,0.35)",f.shadowBlur=8),f.fillText("~ Made by Soumyadip",c-22,d-22),f.restore(),a||e.qr){const e=location.href,t=Math.min(120,Math.floor(.12*c));await drawQR(f,e,c-t-28,d-t-36,t,"normal"===p?"rgba(255,255,255,0.28)":"rgba(246,214,107,0.45)")}await shareOrDownload(m,i,s,"neo-temp-share"),playChime?.(1200),vibrate?.(12),spawn?.(innerWidth-80,80,"gold")}function makeInviteLink({base:e=location.origin+location.pathname,code:t,meta:n={}}={}){const o=t||(crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).slice(2));return`${e}?${new URLSearchParams({invite:o,...n}).toString()}`}function getInviteParams(){const e=new URLSearchParams(location.search);return{invite:e.get("invite"),ref:e.get("ref"),campaign:e.get("campaign")}}function makeInviteLink({base:e=location.origin+location.pathname,code:t,meta:n={}}={}){const o=t||(crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).slice(2));return`${e}?${new URLSearchParams({invite:o,...n}).toString()}`}function wrapText(e,t,n,o,a,r){const i=t.split(/\s+/);let s="",l=o;for(let t=0;t<i.length;t++){const o=s?s+" "+i[t]:i[t];e.measureText(o).width<=a?s=o:(e.fillText(s,n,l),l+=r,s=i[t])}return s&&e.fillText(s,n,l),l}function drawQRPanel(e,t,n,o,a,r){const i=16;e.save(),e.shadowColor="rgba(0,0,0,0.35)",e.shadowBlur=10,e.shadowOffsetY=3,e.fillStyle="normal"===r?"rgba(255,255,255,0.07)":"rgba(255,245,205,0.06)",e.beginPath(),e.moveTo(t+i,n),e.lineTo(t+o-i,n),e.quadraticCurveTo(t+o,n,t+o,n+i),e.lineTo(t+o,n+a-i),e.quadraticCurveTo(t+o,n+a,t+o-i,n+a),e.lineTo(t+i,n+a),e.quadraticCurveTo(t,n+a,t,n+a-i),e.lineTo(t,n+i),e.quadraticCurveTo(t,n,t+i,n),e.closePath(),e.fill();let s=e.createLinearGradient(t,n,t+o,n+a);"gold"===r?(s.addColorStop(0,"#5d4e2a"),s.addColorStop(.5,"#f6e27a"),s.addColorStop(1,"#5d4e2a")):"rose"===r?(s.addColorStop(0,"#6d3943"),s.addColorStop(.5,"#ffb7b2"),s.addColorStop(1,"#6d3943")):"plat"===r?(s.addColorStop(0,"#6f7f8f"),s.addColorStop(.5,"#d8e1e8"),s.addColorStop(1,"#6f7f8f")):(s.addColorStop(0,"#2a3b55"),s.addColorStop(.5,"#9cd3ff"),s.addColorStop(1,"#2a3b55")),e.shadowBlur=0,e.lineWidth=2,e.strokeStyle=s,e.stroke(),e.restore()}async function drawQR(e,t,n,o,a,r="rgba(246,214,107,0.45)"){if(window.QRCode&&window.QRCode.ErrorCorrectLevel){const i=new window.QRCode(-1,window.QRCode.ErrorCorrectLevel.M);i.addData(t),i.make();const s=i.getModuleCount(),l=a/s;e.save(),e.fillStyle="#fff",e.fillRect(n-4,o-4,a+8,a+8),e.fillStyle="#000";for(let t=0;t<s;t++)for(let a=0;a<s;a++)if(i.isDark(t,a)){const r=Math.round(n+a*l),i=Math.round(o+t*l),s=Math.ceil(l),c=Math.ceil(l);e.fillRect(r,i,s,c)}return e.restore(),e.save(),e.strokeStyle=r,e.lineWidth=2,e.strokeRect(n-2,o-2,a+4,a+4),void e.restore()}if(window.QRCode&&"function"==typeof window.QRCode&&!window.QRCode.ErrorCorrectLevel){const i=document.createElement("div");i.style.position="fixed",i.style.left="-9999px",document.body.appendChild(i),new window.QRCode(i,{text:t,width:a,height:a,colorDark:"#000000",colorLight:"#ffffff",correctLevel:window.QRCode.CorrectLevel?window.QRCode.CorrectLevel.M:1});let s=i.querySelector("canvas")||i.querySelector("img");if(!s)throw document.body.removeChild(i),new Error("qrcodejs canvas/img not found");return await new Promise(e=>setTimeout(e,0)),"IMG"===s.tagName?(await new Promise(e=>{if(s.complete)return e();s.onload=()=>e(),s.onerror=()=>e()}),e.drawImage(s,n,o,a,a)):e.drawImage(s,n,o,a,a),e.save(),e.strokeStyle=r,e.lineWidth=2,e.strokeRect(n-2,o-2,a+4,a+4),e.restore(),void document.body.removeChild(i)}console.warn("QR library not found. Include qrcode-generator OR qrcodejs before app.js"),e.save(),e.fillStyle="rgba(0,0,0,0.2)",e.fillRect(n,o,a,a),e.fillStyle="#fff",e.font="600 12px ui-sans-serif, system-ui",e.textAlign="center",e.textBaseline="middle",e.fillText("QR lib missing",n+a/2,o+a/2),e.restore()}async function generateInvitationQRCard(e={}){const{host:t="Soumyadip",title:n="You’re Invited!",subtitle:o="Scan to join Neo Temperature Lab",code:a,ref:r,campaign:i,preset:s="classic",format:l="png",quality:c=.95,showLogo:d=!0,showScanCaption:u=!0}=e,m={classic:{w:900,h:470},social:{w:1200,h:630},story:{w:1080,h:1920},square:{w:1080,h:1080}},{w:f,h:p}=m[s]||m.classic,h=Math.min(window.devicePixelRatio||1,3),y=document.createElement("canvas");y.width=Math.round(f*h),y.height=Math.round(p*h),y.style.width=f+"px",y.style.height=p+"px";const g=y.getContext("2d");g.scale(h,h);const v=currentThemeKey(),S=themeColors(v);fillBrushed(g,f,p,S.bg1,S.bg2),isPremium()&&overlayNoise(g,f,p,.05),strokeBezel(g,f,p,v),d&&drawRoundLogo(g,CARD_LOGO,{cx0:72,cy0:70,r:32,fallback:"🌡️"}),drawNameplate(g,"Neo Temperature Lab",d?120:40,70,v,{padX:18,padY:10,radius:16,maxW:f-(d?160:80)}),g.textAlign="left",g.textBaseline="alphabetic",g.fillStyle=S.text;let C="story"===s?60:40;for(;C>=26&&(g.font=`800 ${C}px ui-sans-serif, system-ui, Segoe UI`,!(g.measureText(n).width<=f-80));)C-=2;g.shadowColor="rgba(0,0,0,0.35)",g.shadowBlur=6,g.shadowOffsetY=2,g.fillText(n,40,160),g.shadowBlur=0,g.font="600 20px ui-sans-serif, system-ui, Segoe UI",g.fillStyle="normal"===v?"#cfe2ff":S.sub,g.fillText(o,40,190);const w=`Host: ${t}`;g.font="700 16px ui-sans-serif, system-ui, Segoe UI";const b=g.measureText(w).width+20,x=40,T=210;g.beginPath(),g.moveTo(52,T),g.lineTo(x+b-12,T),g.quadraticCurveTo(x+b,T,x+b,222),g.lineTo(x+b,226),g.quadraticCurveTo(x+b,238,x+b-12,238),g.lineTo(52,238),g.quadraticCurveTo(x,238,x,226),g.lineTo(x,222),g.quadraticCurveTo(x,T,52,T);const L=g.createLinearGradient(x,T,x+b,238);"gold"===v?(L.addColorStop(0,"#5d4e2a"),L.addColorStop(1,"#f6e27a")):"rose"===v?(L.addColorStop(0,"#6d3943"),L.addColorStop(1,"#ffb7b2")):"plat"===v?(L.addColorStop(0,"#6f7f8f"),L.addColorStop(1,"#d8e1e8")):(L.addColorStop(0,"#2a3b55"),L.addColorStop(1,"#9cd3ff")),g.fillStyle=L,g.fill(),g.fillStyle="normal"===v?"#0b1426":"#1b150a",g.fillText(w,50,229);const E=Math.min(Math.floor(.36*f),420),k=Math.min(Math.floor(.68*p),420),I=f-E-32,U=Math.floor((p-k)/2);drawQRPanel(g,I,U,E,k,v);const B=makeInviteLink({code:a,meta:{ref:r,campaign:i}}),R=u?26:0,P=Math.min(E-36,k-36-R);g.save(),g.fillStyle="#ffffff";const A=I+Math.floor((E-P)/2),M=U+Math.floor((k-R-P)/2);g.fillRect(A-6,M-6,P+12,P+12),g.restore(),await drawQR(g,B,A,M,P,"normal"===v?"rgba(255,255,255,0.28)":"rgba(246,214,107,0.45)"),u&&(g.font="700 14px ui-sans-serif, system-ui, Segoe UI",g.textAlign="center",g.textBaseline="alphabetic",g.fillStyle="normal"===v?"#cfe2ff":S.sub,g.fillText("Scan to Join",I+E/2,U+k-10)),g.textAlign="left",g.textBaseline="alphabetic",g.fillStyle=S.text,g.font="700 18px ui-sans-serif, system-ui, Segoe UI",g.fillText("Why Neo Temperature Lab?",40,260),g.font="600 16px ui-sans-serif, system-ui, Segoe UI",g.fillStyle="normal"===v?"#cfe2ff":S.sub,wrapText(g,["• Ultra-fast & precise temperature conversions across °C, °F, K, °R, and °Re.","• Premium Gold/Rose/Platinum themes with pro-grade UI animations.","• Smart input (e.g., “100 C -> all”), favorites, history & CSV export.","• PWA: Installable, offline-ready, and share-friendly."].join(" "),40,286,Math.min(f-E-80,560),22),g.font="14px ui-sans-serif, system-ui, Segoe UI",g.fillStyle="normal"===v?"#8b5cf6":S.accent,g.textAlign="left",g.fillText(`Generated ${stampIST()}`,40,p-28),g.save(),g.font="600 16px ui-sans-serif, system-ui, Segoe UI",g.textAlign="right",g.fillStyle="normal"===v?"#6ad1ff":S.accent,isPremium()&&(g.shadowColor="rgba(246,214,107,0.35)",g.shadowBlur=8),g.fillText("~ Made by Soumyadip",f-22,p-22),g.restore(),await shareOrDownload(y,l,c,"neo-temp-invite"),playChime?.(1200),vibrate?.(12),spawn?.(innerWidth-80,80,"gold")}powerInput.addEventListener("change",applyPowerInput),powerInput.addEventListener("keydown",e=>{"Enter"===e.key&&(e.preventDefault(),applyPowerInput()),"Escape"===e.key&&(e.preventDefault(),powerInput.value="")}),[inputValue,fromUnit,toUnit].forEach(e=>{e.addEventListener("input",runConvertDebounced),e.addEventListener("change",runConvert)}),precision.addEventListener("input",()=>{precisionNum.value=precision.value,runConvert(!1)}),precisionNum.addEventListener("input",()=>{const e=clamp(+precisionNum.value||0,0,8);precision.value=e,precisionNum.value=e,runConvert(!1)}),sigfigs.addEventListener("change",()=>runConvert(!1)),scientific.addEventListener("change",()=>runConvert(!1)),swapBtn.addEventListener("click",swapUnits),copyBtn.addEventListener("click",copyResult),shareCardBtn.addEventListener("click",generateShareCard),resetBtn.addEventListener("click",resetInputs),copyLinkBtn.addEventListener("click",copyLink),clearAllBtn.addEventListener("click",resetAll),clearHistoryBtn.addEventListener("click",clearHistory),exportCSV.addEventListener("click",exportHistoryCSV),favBtn.addEventListener("click",addCurrentToFavs),clearFavs.addEventListener("click",clearFavorites),premiumSwitch.addEventListener("change",e=>e.target.checked?enablePremium():disablePremium()),premiumTheme.addEventListener("change",e=>setPremiumTheme("platinum"===e.target.value?"platinum":e.target.value)),document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&"k"===e.key.toLowerCase()&&(e.preventDefault(),swapUnits()),"Enter"===e.key&&(e.preventDefault(),copyResult()),"Escape"===e.key&&(e.preventDefault(),resetInputs())}),document.getElementById("inviteBtn")?.addEventListener("click",()=>{generateInvitationQRCard({host:"Soumyadip",preset:"classic",format:"png",quality:.95})}),["gesturestart","gesturechange","gestureend"].forEach(e=>{document.addEventListener(e,e=>e.preventDefault(),{passive:!1})});let lastTouchEnd=0;function renderAll(){syncGoldSelects(),runConvert(!1)}document.addEventListener("touchend",e=>{const t=Date.now();t-lastTouchEnd<=300&&e.preventDefault(),lastTouchEnd=t},{passive:!1}),window.addEventListener("wheel",e=>{e.ctrlKey&&e.preventDefault()},{passive:!1}),window.addEventListener("keydown",e=>{!e.ctrlKey&&!e.metaKey||"+"!==e.key&&"-"!==e.key&&"="!==e.key||e.preventDefault()}),readURLState(),restorePremiumFromStorage(),renderAll(),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js").catch(()=>{})});
//# sourceMappingURL=app.min.js.map